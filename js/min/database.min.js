function onProfileSubmit(e){e.preventDefault(),InsertData()}function transactionDB(e){var t=window.openDatabase(DBname,DBversion,DBdisname,DBsize);t.transaction(e,errorDB)}function onDeviceReady(){transactionDB(CreatQuery)}function InsertData(){transactionDB(InsertQuery)}function ClearData(e){1==e&&(transactionDB(ClearQuery),StatsData())}function ClearSession(e){1==e&&(transactionDB(RemoveCurrentSession),StatsSessionData())}function RefreshData(){transactionDB(RefreshQuery)}function StatsData(){mStats="overview",transactionDB(StatsQuery)}function StatsSessionData(){mStats="session",transactionDB(StatsSessionQuery)}function MaxRecordsQuery(){var e=window.openDatabase(DBname,DBversion,DBdisname,DBsize);e.transaction(function(e){e.executeSql("SELECT COUNT(score) AS s FROM blist",[],function(e,t){t.rows.item(0).s>=MaxRecords?toast("Sorry, Pro Bowling Lite version only allow up to 15 games! Please purchase Full version for unlimited records and new features."):InsertData()}),errorDB})}function StatsQuery(e){e.executeSql("SELECT MAX(score) AS s FROM blist",[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".hs-val").text(a)},errorDB),e.executeSql("SELECT MIN(score) AS s FROM blist",[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".ls-val").text(a)},errorDB),e.executeSql("SELECT MAX(a) AS s FROM (SELECT AVG(score) AS a FROM blist GROUP BY date);",[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".ha-val").text(Math.floor(a))},errorDB),e.executeSql("SELECT MIN(a) AS s FROM (SELECT AVG(score) AS a FROM blist GROUP BY date);",[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".la-val").text(Math.floor(a))},errorDB),e.executeSql("SELECT SUM(score) AS s FROM blist",[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".tp-val").text(a)},errorDB),e.executeSql("SELECT COUNT(score) AS s FROM blist",[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".tg-val").text(a)},errorDB),e.executeSql("SELECT AVG(score) AS s FROM blist",[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".ta-val").text(Math.floor(a))},errorDB),e.executeSql('SELECT SUM(strikes) AS s FROM blist WHERE frames="true"',[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".tsk-val").text(Math.floor(a))},errorDB),e.executeSql('SELECT AVG(strikes) AS s FROM blist WHERE frames="true"',[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".ask-val").text(Math.floor(a))},errorDB),e.executeSql('SELECT SUM(spares) AS s FROM blist WHERE frames="true"',[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".tsp-val").text(Math.floor(a))},errorDB),e.executeSql('SELECT AVG(spares) AS s FROM blist WHERE frames="true"',[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".asp-val").text(Math.floor(a))},errorDB)}function StatsSessionQuery(e){var t=$("#date-page .date-header").text(),a=new Date(t),r=dateToYMD(a);e.executeSql('SELECT MAX(score) AS s FROM blist WHERE date="'+r+'"',[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".hs-val").text(a)},errorDB),e.executeSql('SELECT MIN(score) AS s FROM blist WHERE date="'+r+'"',[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".ls-val").text(a)},errorDB),e.executeSql('SELECT SUM(score) AS s FROM blist WHERE date="'+r+'"',[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".tp-val").text(a)},errorDB),e.executeSql('SELECT COUNT(score) AS s FROM blist WHERE date="'+r+'"',[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".tg-val").text(a)},errorDB),e.executeSql('SELECT AVG(score) AS s FROM blist WHERE date="'+r+'"',[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".ta-val").text(Math.floor(a))},errorDB),e.executeSql('SELECT SUM(strikes) AS s FROM blist WHERE frames="true" AND date="'+r+'"',[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".tsk-val").text(Math.floor(a))},errorDB),e.executeSql('SELECT AVG(strikes) AS s FROM blist WHERE frames="true" AND date="'+r+'"',[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".ask-val").text(Math.floor(a))},errorDB),e.executeSql('SELECT SUM(spares) AS s FROM blist WHERE frames="true" AND date="'+r+'"',[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".tsp-val").text(Math.floor(a))},errorDB),e.executeSql('SELECT AVG(spares) AS s FROM blist WHERE frames="true" AND date="'+r+'"',[],function(e,t){var a=null==t.rows.item(0).s?0:t.rows.item(0).s;$(".asp-val").text(Math.floor(a))},errorDB)}function CreatQuery(e){for(var t="",a=2;22>=a;a++)22!=a?t=t+"frame_"+parseInt(a/2)+"_"+(a%2==0?"1":"2")+" varchar(1), ":t+="frame_10_3 varchar(1)";e.executeSql("CREATE TABLE IF NOT EXISTS blist (id INTEGER PRIMARY KEY AUTOINCREMENT,score Integer,date varchar, file varchar, frames varchar, strikes Integer, spares Integer,"+t+")",[],function(){},errorDB)}function RefreshQuery(e){$("#bowl_list").empty(),CreatQuery(e),e.executeSql("SELECT AVG(score) AS a, COUNT(score) AS c, date FROM blist GROUP BY date ORDER BY date DESC",[],function(e,t){for(var a=t.rows.length,r=0;a>r;r++){var i=t.rows.item(r).date,o=Math.floor(t.rows.item(r).a),s=t.rows.item(r).c,n=new Date(i),l='<li id="all_'+r+'" data-theme="o'+r%2+'"><a href="#date-page" data-transition="slide" data-rel="page" onclick="DateQuery('+n.valueOf()+');" class="ui-link-inherit"> ['+dateToYMD(n)+"] "+s+" games Avg - "+o+"</a></li>";$("#bowl_list").append(l)}freshList("bowl_list")},errorDB)}function InsertQuery(e){if("ready"!=mStatus)return alert("Phone not ready to save data!"),void 0;var t=$("#scoreinput").val(),a=$("#dateinput").val(),r=new String(a);return""==t||""==a||parseInt(t)>300||parseInt(t)<0?(toast("Empty/Invalid Fields！"),void 0):(1==isCompleted()&&$("#edit-final-res").text()==$("#scoreinput").val()?e.executeSql("INSERT INTO blist (score,date,file,frames,strikes,spares,"+frameCols+') VALUES ("'+t+'","'+r+'", "'+mFile+'", "true",'+getStrikes()+","+getSpares()+","+getScores()+")",[],function(){$.mobile.back()},errorDB):e.executeSql("INSERT INTO blist (score,date,file,frames,strikes,spares,"+frameCols+') VALUES ("'+t+'","'+r+'", "'+mFile+'", "false",0,0, "","","","","","","","","","","","","","","","","","","","","")',[],function(){$.mobile.back()},errorDB),RefreshQuery(e),void 0)}function DateQuery(e){mDate=e;var t=new Date(e),a=dateToYMD(t);$(".date-header").text(t.toDateString()),$("#date_list").empty();var r=window.openDatabase(DBname,DBversion,DBdisname,DBsize);r.transaction(function(e){e.executeSql('SELECT id, score FROM blist WHERE date="'+a+'" ORDER BY id',[],function(e,t){var a=t.rows.length;if(a>0){for(var r=0;a>r;r++){var i=t.rows.item(r).id,o=t.rows.item(r).score,s='<li id="all_'+i+'"  data-theme="o'+r%2+'""><a href="#record-page" data-rel="page" data-transition="slide" onclick="GetImage('+i+');"> Game '+(r+1)+" - "+o+"</a></li>";$("#date_list").append(s)}freshList("date_list")}else $.mobile.back()},errorDB)})}function ClearQuery(e){$("#bowl_list").empty(),e.executeSql("DELETE FROM blist"),e.executeSql("DROP TABLE blist"),CreatQuery(e),freshList("bowl_list")}function RemoveCurrentGame(){navigator.notification.confirm("Delete?",function(e){if(1==e){var t=window.openDatabase(DBname,DBversion,DBdisname,DBsize);t.transaction(function(e){e.executeSql('DELETE FROM blist WHERE id="'+mId+'"')}),DateQuery(mDate),RefreshData(),$.mobile.back()}})}function RemoveCurrentSession(){var e=$("#date-page .date-header").text(),t=new Date(e),a=dateToYMD(t),r=window.openDatabase(DBname,DBversion,DBdisname,DBsize);r.transaction(function(e){e.executeSql('DELETE FROM blist WHERE date="'+a+'"')}),DateQuery(mDate),RefreshData(),$.mobile.back()}function GetImage(e){mFile="";var t=window.openDatabase(DBname,DBversion,DBdisname,DBsize);t.transaction(function(t){t.executeSql("SELECT file,date,score,frames,"+frameCols+' FROM blist WHERE id="'+e+'"',[],function(t,a){var r=a.rows.length;if(r>0){{var i=a.rows.item(0).file,o=new Date(a.rows.item(0).date);a.rows.item(0).score,a.rows.item(0).frames}$(".date-header").text(o.toDateString()),mId=e,("NULL"!=i||""!=i)&&(mFile=i),populateScores(a.rows.item(0))}})}),gamesCarousel(e)}function gamesCarousel(e){$(".caro-container").empty();var t=0,a=dateToYMD(new Date(mDate)),r=window.openDatabase(DBname,DBversion,DBdisname,DBsize);r.transaction(function(r){r.executeSql('SELECT id,score FROM blist WHERE date="'+a+'"',[],function(a,r){var i=r.rows.length;if(i>0){for(var o=0;i>o;o++){var s=r.rows.item(o).id;e==s&&(t=o);var n=r.rows.item(o).score,l='<div id="'+s+'" class="item view-final-res-container final-res-container"><h3>Game '+(o+1)+'</h3><h1 class="view-final-res final-res">'+n+"</h1></div>";$(".caro-container").data("owlCarousel").addItem(l)}$(".owl-carousel").data("owlCarousel").jumpTo(t)}})})}function afterAction(){$("#view-final-res-caro");id=this.owl.userItems[this.owl.currentItem].id;var e=window.openDatabase(DBname,DBversion,DBdisname,DBsize);e.transaction(function(e){e.executeSql("SELECT score,frames,"+frameCols+' FROM blist WHERE id="'+id+'"',[],function(e,t){var a=t.rows.length;if(a>0){{t.rows.item(0).score,t.rows.item(0).frames}populateScores(t.rows.item(0))}})})}function ConfirmAllClear(){navigator.notification.confirm("Clear All Data?",ClearData)}function ConfirmSessionClear(){navigator.notification.confirm("Clear Session Data?",ClearSession)}function FindPhoto(){0==arguments.length?navigator.camera.getPicture(onEditSuccess,onCameraError,{quality:40,allowEdit:!0,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.DATA_URL}):(navigator.camera.getPicture(onNewSuccess,onCameraError,{quality:40,allowEdit:!0,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.DATA_URL}),mStatus="busy")}function TakePhoto(){0==arguments.length?navigator.camera.getPicture(onEditSuccess,onCameraError,{quality:40,allowEdit:!0,destinationType:Camera.DestinationType.DATA_URL}):(navigator.camera.getPicture(onNewSuccess,onCameraError,{quality:40,allowEdit:!0,destinationType:Camera.DestinationType.DATA_URL}),mStatus="busy")}function onEditSuccess(e){var t=window.openDatabase(DBname,DBversion,DBdisname,DBsize);t.transaction(function(t){t.executeSql('UPDATE blist SET file="'+e+'" WHERE id="'+mId+'"')});var a='<img class="game-photo" src="data:image/jpeg;base64,'+e+'"></img>';$("#photo-content").html(a),$("#photo-content").trigger("create")}function onNewSuccess(e){mStatus="ready",mFile="data:image/jpeg;base64,"+e}function errorDB(e){alert("Error processing SQL: "+e.code)}function successDB(){}function onCameraError(e){alert("Failed because: "+e)}function onSuccess(){}function onError(){}function dateToYMD(e){var t=e.getDate(),a=e.getMonth()+1,r=e.getFullYear();return""+r+"-"+(9>=a?"0"+a:a)+"-"+(9>=t?"0"+t:t)}function freshList(e){var t="#"+e;$(t).listview("refresh")}function resetFields(){mCanvas="",mFile="",$("#scoreinput").val(""),$("#scoreinput").trigger("create"),document.getElementById("dateinput").valueAsDate=new Date,calc("edit","new")}function share(){""!=mCanvas?window.plugins.socialsharing.available(function(e){e?window.plugins.socialsharing.share("Sharing my score via Pro Bowl app","My Name",mCanvas,null):alert("Social Plugin not available")}):toast("Frames scores not recorded. Unable to share.")}function shareComplete(){mCanvas="",isCompleted()?html2canvas($("#edit-bowling-calc-score-container"),{onrendered:function(e){mCanvas=e.toDataURL("image/jepg"),share()}}):toast("Frames scores not recorded. Unable to share.")}function shareCapture(){mCanvas="",""!=$("#view-frame1-res").text().trim()?html2canvas($("#view-bowling-calc-score-container"),{onrendered:function(e){mCanvas=e.toDataURL("image/jepg"),share()}}):toast("Frames scores not recorded. Unable to share.")}function saveCapture(){isCompleted()&&html2canvas($("#edit-bowling-calc-score-container"),{onrendered:function(e){mCanvas=e.toDataURL("image/jepg"),$("#scoreinput").val($("#edit-final-res").text())}})}function isLandscape(){return $(window).width()>$(window).height()}function toast(e){window.plugins.toast.show(e,"long","center")}function buttonFeedback(){}function draw(){drawLine($("#lineCanvas")),drawPie($("#pieCanvas"))}function drawLine(e){e.empty();var t=.95*deviceWidth,a=$(window).height()*mGraphHeightRatio;e.attr("width",t),e.attr("height",a);var r={labels:[],datasets:[{fillColor:"#FF9500",strokeColor:"rgba(220,220,220,1)",pointColor:"#FFAA33",pointStrokeColor:"#fff",data:[],title:"Hello"}]},i="";i="overview"==mStats?"SELECT AVG(score) AS a, date FROM blist GROUP BY date ORDER BY date DESC LIMIT 5":'SELECT score AS a FROM blist WHERE date="'+dateToYMD(new Date(mDate))+'" ORDER BY id DESC';var o=window.openDatabase(DBname,DBversion,DBdisname,DBsize);o.transaction(function(t){t.executeSql(i,[],function(t,a){for(var i=a.rows.length,o=0,s=300,n=i-1;n>=0;n--){var l="Game "+(i-n),c=Math.floor(a.rows.item(n).a);if(c>o&&(o=c),s>c&&(s=c),"overview"==mStats){var u=new Date(a.rows.item(n).date),m=u.getDate(),d=u.getMonth()+1;l=(9>=m?"0"+m:m)+"-"+(9>=d?"0"+d:d)}r.labels.push(l),r.datasets[0].data.push(c)}s=s>50?s-50:0;{var f={scaleOverride:!0,scaleSteps:10,scaleStepWidth:Math.floor((o-s)/10),scaleStartValue:s};new Chart(e.get(0).getContext("2d")).Line(r,f)}})})}function drawPie(e){e.empty();var t=.95*deviceWidth,a=$(window).height()*mGraphHeightRatio;e.attr("width",t),e.attr("height",a);var r=[{value:0,color:"#FF3A2D",title:"Strikes"},{value:0,color:"#FF9500",title:"Spares"},{value:0,color:"#4A4A4A",title:"Open"}],i={animationSteps:50,inGraphDataShow:!0,inGraphDataAnglePosition:2,inGraphDataRadiusPosition:2,inGraphDataRotate:"inRadiusAxisRotateLabels",inGraphDataAlign:"center",inGraphDataVAlign:"middle",inGraphDataFontColor:"white",inGraphDataFontSize:11},o="";o="overview"==mStats?'SELECT AVG(strikes) AS a, AVG(spares) AS s FROM blist WHERE frames="true"':'SELECT AVG(strikes) AS a, AVG(spares) AS s FROM blist WHERE frames="true" AND date="'+dateToYMD(new Date(mDate))+'"';var s=window.openDatabase(DBname,DBversion,DBdisname,DBsize);s.transaction(function(t){t.executeSql(o,[],function(t,a){var o=null==a.rows.item(0).a?0:a.rows.item(0).a,s=null==a.rows.item(0).s?0:a.rows.item(0).s;r[0].value=Math.floor(o),r[1].value=Math.floor(s),r[2].value=11-Math.floor(o)-Math.floor(s);new Chart(e.get(0).getContext("2d")).Pie(r,i)})})}const DBname="bowlList",DBversion="1,0",DBdisname="listDB",DBsize=4e6,MaxRecords=15;for(var mId=0,mCanvas="",mFile="",mDate="",mStatus="ready",deviceWidth=0,mGraphHeightRatio=.6,mStats="overall",frameCols="",i=2;22>=i;i++)frameCols=19>=i?frameCols+"frame_"+parseInt(i/2)+"_"+(i%2==0?"1":"2")+", ":21>=i?frameCols+"frame_10_"+parseInt(i-19)+", ":frameCols+"frame_10_"+parseInt(i-19);var init=function(){onDeviceReady();deviceWidth=$(window).width(),$(window).resize(function(){"score-page"==$.mobile.activePage.attr("id")&&buttonsRedraw()}),$(".graph-slide").owlCarousel({navigation:!1,slideSpeed:300,paginationSpeed:400,pagination:!0,singleItem:!0,afterMove:draw}),$(".caro-container").owlCarousel({navigation:!1,slideSpeed:300,paginationSpeed:400,pagination:!0,singleItem:!0,afterMove:afterAction}),FastClick.attach(document.body)};$(document).ready(init),$(document).on("pagecontainershow",function(){$.mobile.pageContainer.pagecontainer("getActivePage").prop("id")});